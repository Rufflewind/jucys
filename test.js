!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=190)}({109:function(e,t,n){},110:function(e,t,n){},14:function(e,t,n){"use strict";n.d(t,"j",(function(){return c})),n.d(t,"d",(function(){return I})),n.d(t,"h",(function(){return U})),n.d(t,"e",(function(){return W})),n.d(t,"k",(function(){return F})),n.d(t,"l",(function(){return G})),n.d(t,"c",(function(){return Q})),n.d(t,"i",(function(){return ae})),n.d(t,"m",(function(){return be})),n.d(t,"n",(function(){return ve})),n.d(t,"b",(function(){return $e})),n.d(t,"f",(function(){return Ee})),n.d(t,"a",(function(){return Re})),n.d(t,"g",(function(){return Dt}));n(109),n(110);var r=n(94),i=n.n(r);function s(e){return e}function o(e,t){return e==t}function a(e,t){return e<t?-1:t<e?1:0}function l(e,t,n){const r=e.length,i=t.length,s=r<i?r:i;for(let r=0;r<s;++r){const i=n(e[r],t[r]);if(i)return i}return a(r,i)}function c(e,t){let n=new Map;for(const[r,i]of t.entries()){if(n.has(i))return 0;n.set(i,e[r])}let r=new Set(e),i=1;for(;r.size;){const e=r.values().next().value;r.delete(e);let t=e;do{if(!n.has(t))return 0;t=n.get(t),r.delete(t),i*=-1}while(t!=e);i*=-1}return i}function u(e){return e>0?1:e<0?-1:0}function d(e,t){return(e%t+t)%t}function f(e,t,n){return n<e?e:n>t?t:n}function p(e,t){return e?t+e/2-d(t+e/2,e):t}function h(e,t){return e^t}function*g(e,t){for(let n=e;n<t;++n)yield n}function*m(e,t,n){n=n||0;for(const r of t)yield e(r,n),n+=1}function*y(e,t){for(const n of t)e(n)&&(yield n)}function*w(e,t){let n=0;for(const r of t){if(n>=e)break;yield r,n+=1}}function b(e,t){e=e.slice(),(t=Array.from(t)).sort((e,t)=>t-e);const n=t.length;for(let r=0;r<n;++r){if(t[r]>=e.length)throw new Error("index out of range");e.splice(t[r],1)}return e}let v=0;const O=new WeakMap;function j(e,t,n){return e.hasOwnProperty(t)?e[t]:n}function x(e){return JSON.parse(JSON.stringify(e))}function I(e,t){const n=function e(t,n){if(t===n)return null;if(typeof t!=typeof n)return{type:"typeMismatch",left:t,right:n};const r=Array.isArray(t),i=Array.isArray(n);if(r||i){if(r!=i)return{type:"typeMismatch",left:t,right:n};const s=t.length,o=n.length;if(s!=o)return{type:"lengthMismatch",left:s,right:o};for(const[r,i]of t.entries()){const t=e(i,n[r]);if(t)return{type:"propertyValueMismatch",prop:r,diff:t}}return null}if("object"==typeof t){const r=Object.getPrototypeOf(t),i=Object.getPrototypeOf(n);if(r!=i)return{type:"prototypeMismatch",left:r,right:i};for(const r of Object.keys(t)){if(!n.hasOwnProperty(r))return{type:"missingProperty",left:r};const i=e(t[r],n[r]);if(i)return{type:"propertyValueMismatch",prop:r,diff:i}}for(const e of Object.keys(n))if(!t.hasOwnProperty(e))return{type:"missingProperty",right:e};return null}return{type:"notEqual",left:t,right:n}}(e,t);null!=n&&console.warn(e,t,n),console.assert(null==n)}function k(e,t,n,r,i,s){const o=n-i,a=r-s,l=i-e,c=s-t,d=e-n,f=t-r,p=a*d-f*o;if(0==p)return 0;const h=(d*l+f*c)/p,g=.5*Math.sqrt(Math.pow(o-a*h,2)+Math.pow(a+o*h,2));return-u(a*l-o*c)*g-h/2*Math.sqrt(o*o+a*a)}function S(e,...t){e=Array.from(e);for(const n of t)for(const[t,r]of n.entries())e[t]+=r;return e}function $(e,...t){e=Array.from(e);for(const n of t)for(const[t,r]of n.entries())e[t]-=r;return e}function E(e,t){let n=0;for(const r of e.keys())n+=e[r]*t[r];return n}function D(e,t){t=Array.from(t);for(const n of t.keys())t[n]*=e;return t}const P={ZERO:0,ONE:1,add:(e,t)=>e+t,subtract:(e,t)=>e-t,multiply:(e,t)=>e*t,divide:(e,t)=>{if(!t)throw new Error("division by zero");return e/t},eq:o},z=Object.assign({},P,{add:h,subtract:h});const M=(N=N||o,L=void 0===L?0:L,class e{constructor(e){if(this.data=new Map,e)for(const[t,n]of e)this.set(t,n)}copy(){return new e(this)}[Symbol.iterator](){return this.data.entries()}keys(){return this.data.keys()}get(e){const t=this.data;return t.has(e)?t.get(e):L}set(e,t){N(t,L)?this.delete(e):this.data.set(e,t)}modify(e,t){this.set(e,t(this.get(e)))}delete(e){this.data.delete(e)}map(t){return new e(m(([e,n])=>[e,t(n,e)],this))}toTable(e){e=e||this.keys();let t={};for(const n of e)t[n]=this.get(n);return t}});var N,L;const A=(H=H||M,class e{constructor(e){if(this.data=new Map,e)for(const[t,n,r]of e)this.set(t,n,r)}copy(){return new e(this)}*[Symbol.iterator](){for(const[e,t]of this.rows())yield*m(([t,n])=>[e,t,n],t)}rows(){return m(e=>[e,this.row(e)],this.data.keys())}row(e){return function(e,t,n){if(!e.has(t)){const r=n();return e.set(t,r),r}return e.get(t)}(this.data,e,()=>new H)}rowKeys(){return this.data.keys()}colKeys(){let e=new Set;for(const t of this.data.values())for(const n of t.keys())e.add(n);return e}get(e,t){return this.row(e).get(t)}set(e,t,n){this.row(e).set(t,n)}modify(e,t,n){this.set(e,t,n(this.get(e,t)))}deleteRow(e){this.data.delete(e)}map(t){return new e(m(([e,n,r])=>[e,n,t(r,n,e)],this))}toTable(e,t){e=e||this.rowKeys(),t=t||Array.from(this.colKeys());let n={};for(const r of e)n[r]=this.row(r).toTable(t);return n}});var H;const q=Symbol("VNODE_KEY"),T=Symbol("VNODE_SUSPEND_CHILDREN"),B=Symbol("VNODE_SYMBOLS"),R=Symbol("VNODE_EVENT_LISTENERS");function _(e,t){let n=t[R],r=Object.assign({},n);const i=Object.keys(e);let s=i.length;for(;s--;){const o=i[s],a=e[o];let l=/^on(.+)/.exec(o);if(l){const e=l[1];n||(n={},t[R]=n);let i=n[e];i?delete r[e]:(i=[void 0],n[e]=i,t.addEventListener(e,(function(e){return i[0].call(this,e)}))),i[0]=a}else null==a?t.removeAttribute(o,a):t.getAttribute(o)!=a&&t.setAttribute(o,a)}const o=Object.getOwnPropertySymbols(e);for(s=o.length;s--;){let n=t[B];n||(n={},t[B]=n);const r=o[s];n[r]=e[r]}const a=Object.keys(r);let l=a.length;for(;l--;){const e=a[l];t.removeEventListener(e,r[e])}}function C(e,t){if(!e)return;let n=t.childNodes;if(!n)return;let r=document.createDocumentFragment(),i=0;for(let s=0;s<e.length;++s){let o=e[s],a=n[i];if(o instanceof X){const e=o.attributes[q];if(e)for(;a;){if(a instanceof Element||a instanceof Text){if((a[B]||{})[q]==e)break;t.removeChild(a)}else t.insertBefore(r,a),i+=1;a=n[i]}else a&&(a[B]||{})[q]&&(a=null);if(a){if(a instanceof HTMLElement?a.nodeName.toLowerCase()==o.name.toLowerCase():a.namespaceURI==o.namespace&&a.nodeName==o.name){t.insertBefore(r,a),i+=1,o.renderTo(a);continue}t.removeChild(a)}o=o.create()}else if("string"==typeof o){if(a instanceof Text){t.insertBefore(r,a),i+=1,a.nodeValue!=o&&(a.nodeValue=o);continue}o=document.createTextNode(o)}r.appendChild(o)}for(;i<n.length;){let e=n[i];e instanceof Element||e instanceof Text?t.removeChild(e):i+=1}t.appendChild(r)}class X{constructor(e,t,n,r){this.namespace=e,this.name=t,this.attributes=n,this.children=r}renderTo(e){!function(e,t){if(!e)return;let n=t.attributes;if(n){let t=0;for(;t<n.length;){const r=n[t],i=r.name;e.hasOwnProperty(i)||null!=r.ns?t+=1:n.removeNamedItem(i)}}delete t[B],_(e,t)}(this.attributes,e),this.attributes[T]||C(this.children,e)}create(){const e=this.namespace;let t=e?document.createElementNS(e,this.name):document.createElement(this.name);return this.renderTo(t),t}}const Y={svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink"};function J(e,t,...n){let r;return[r,e]=function(e){let t=null;const n=/([^:]+):(.+)/.exec(e);return n&&Y.hasOwnProperty(n[1])&&(t=Y[n[1]],e=n[2]),[t,e]}(e),new X(r,e,t,n)}let K=[];function U(...e){let t=[],n={};return e.forEach(e=>e.forEach(e=>{if(e.length<2)return;let r=null;for(let t=0;t<e.length&&(r=n[e[t]],!r);++t);null==r&&(r=[[]],t.push(r[0])),e.forEach(e=>{const t=n[e];t?t[0]!=r[0]&&(r[0].push(...t[0]),t[0].splice(0,t[0].length),t[0]=r[0]):(r[0].push(e),n[e]=r)})})),Object.freeze(t.map(Object.freeze).filter(e=>e.length>1))}function W(e,t){e=U(e),t=U(t);let n={};e.forEach(e=>e.forEach(t=>n[t]=e));for(let e=0;e<t.length;++e){const r=t[e];let i=null;for(let e=0;e<r.length&&(i=n[r[e]],!i);++e);if(!i)return!1;for(let e=0;e<r.length;++e)if(n[r[e]]!=i)return!1}return!0}function V(e,t){return W(e,t)&&W(t,e)}function Z(e,t){for(let n=0;n<e.length;++n)for(let r=0;r<e[n].length;++r)if(e[n][r]==t)return[n,r];return null}function F(e,t){const n=Z(e,t);if(!n)return[t];const[r,i]=n;return[t].concat(b(e[r],[i]))}function G(e,t){const n=Z(e,t);if(!n)return e;const[r,i]=n;return Object.freeze(Object.assign([],e,{[r]:Object.freeze(b(e[r],[i]))})).filter(e=>e.length>1)}const Q=Object.freeze({phase:0,summed:!1,weight:0});function ee(e){return Object.freeze(Object.assign({},Q,e))}function te(e){const t=/^([\s\S]*?)(\d*)$/.exec(e);return t[1]+(Number(t[2])+1).toString()}function ne(e){return y(t=>!e.hasOwnProperty(t),m(e=>e.toString(),g(1,Number.POSITIVE_INFINITY)))}function re(e){let t=Object.assign({},e.superlines);for(const n of e.deltas)for(const e of n)t[e]=!0;return ne(t)}function ie(...e){let t=Object.assign({},Q);return e.forEach(e=>{t.phase=d(t.phase+(e.phase||0),4),t.weight+=e.weight||0,null!=e.summed&&(t.summed=e.summed)}),Object.freeze(t)}function se(...e){let t={};for(const n of e)for(const e of Object.keys(n)){if("0"==e){t[e]=Q;continue}const r=t[e];let i=n[e];r&&(i=ie(r,i)),t[e]=i}for(const e of Object.keys(t))0!=e.phase||0!=e.weight||e.summed||delete t[e];return Object.freeze(t)}const oe=Object.freeze({superline:"0",direction:0,arrowPos:.5,arcHeight:0,angle:0,textPos:.5,textOffset:0});function ae(e){return le({superline:e})}function le(e){return Object.freeze(Object.assign({},oe,e))}function ce(e){return null!=(e=Object.assign({},e)).direction&&(e.direction=-e.direction),null!=e.arrowPos&&(e.arrowPos=1-e.arrowPos),null!=e.arcHeight&&(e.arcHeight=-e.arcHeight),null!=e.angle&&(e.angle=d(e.angle+Math.PI,2*Math.PI)),null!=e.textPos&&(e.textPos=1-e.textPos),null!=e.textOffset&&(e.textOffset=-e.textOffset),Object.freeze(e)}function ue(e){return"0"==e.superline||1==d(e.direction,2)}function de(...e){return d(function(e){let t=0;for(const n of e)t+=n;return t}(e)+1,4)-1}function fe(...e){e.length;const t=["arrowPos","arcHeight","textPos","textOffset"];let n={},r=0,i=0,s=0,o={};for(const e of t)o[e]=0;for(const[a,l]of e.entries()){if(0==a)n.superline=l.superline;else if(n.superline!=l.superline)throw new Error("cannot add lines with different superlines");null!=l.direction&&(null==n.direction&&(n.direction=0),n.direction=de(n.direction,l.direction));for(const e of t)null!=l[e]&&(null==n[e]&&(n[e]=0),n[e]+=l[e],o[e]+=1);null!=l.angle&&(r+=Math.sin(l.angle),i+=Math.cos(l.angle),s+=1)}for(const e of t)o[e]&&(n[e]/=o[e]);return s&&(n.angle=Math.atan2(r,i)),Object.freeze(n)}function pe(...e){const t=he(fe(...e.map(t=>Object.assign({},t,{superline:e[0].superline}))));return{line:t.line,phase:t.phase,delta:e.map(e=>e.superline)}}function he(e){let t=e.direction%2,n=2*d(Math.trunc(e.direction/2),2);return"0"==e.superline&&(t=0,n=0),{line:Object.freeze(Object.assign({},e,{direction:t})),phase:n}}function ge(e,t,n,r,i){const s=(e+n)/2,o=(t+r)/2;let a=n-e,l=r-t,c=Math.sqrt(a*a+l*l);const p=0==c,h=Math.atan2(l,a);let g=h,m=i.arcHeight;const y=d(i.angle+Math.PI/2,2*Math.PI)<Math.PI?-1:1;if(p){const d=.01;a=d*Math.cos(i.angle),l=d*Math.sin(i.angle),e=s-.5*a,t=o-.5*l,n=s+.5*a,r=o+.5*l,c=d,g=i.angle,m=0==m?50*y:u(m)*f(50,1/0,Math.abs(m))}const w=function(e,t){if(0==t)return{inclination:0,radius:1/0,large:!1,sweep:!1};const n=e/2,r=(n*n/t+t)/2,i=Math.abs(t)>n,s=t<0,o=Math.asin(n/r);return{inclination:i?(s?-1:1)*Math.PI-o:o,radius:r,large:i,sweep:s}}(c,m),b=(w.radius-m)/c,v=s+b*l,O=o-b*a,j={xCenter:v,yCenter:O,startAngle:Math.atan2(t-O,e-v)};return{x0:e,y0:t,x1:n,y1:r,xMid:s,yMid:o,dx:a,dy:l,angle:g,trueAngle:h,lineLength:c,singular:p,line:i,halfDisk:y,arcHeight:m,arc:Object.assign(w,j)}}function me(e,t){const n=e.lines[t],r=je(e.nodes,t),i=e.nodes[r[0]],s=e.nodes[r[1]];return Object.assign({external:[i.type,s.type].includes("terminal")},ge(i.x,i.y,s.x,s.y,n))}function ye(e,t,n){let r,i;if(0==e.arcHeight){const s=t-e.x0,o=n-e.y0;r=(e.dx*s+e.dy*o)/Math.pow(e.lineLength,2),i=-(s*e.dy-o*e.dx)/e.lineLength}else{const s=e.arc,o=t-s.xCenter,a=n-s.yCenter,l=Math.abs(Math.PI/s.inclination),c=.5*l-.5;r=d((s.startAngle-Math.atan2(a,o))/(2*s.inclination)+c,l)-c,i=(Math.sqrt(o*o+a*a)-Math.abs(s.radius))*u(e.arcHeight)}return{pos:r,offset:i}}function we(e,t,n){const r=e.arc;if(0==e.arcHeight){const r=e.lineLength,i=t+n/r;return{x:e.x0+e.dx*i,y:e.y0+e.dy*i,normalX:-e.dy/r,normalY:e.dx/r,tangentAngle:e.angle}}{const i=2*r.inclination*t+n/r.radius,s=e.angle+r.inclination-i,o=s+Math.PI/2,a=Math.cos(o),l=Math.sin(o);return{x:r.xCenter+r.radius*a,y:r.yCenter+r.radius*l,normalX:a,normalY:l,tangentAngle:s}}}function be(e,t,n,r){let i={type:"terminal",lines:Object.freeze([e]),variable:t};return null!=n&&(i.x=n),null!=r&&(i.y=r),Object.freeze(i)}function ve(e,t,n,r,i){let s={type:"w3j",lines:Object.freeze([e,t,n])};return void 0!==r&&(s.x=r),void 0!==i&&(s.y=i),Object.freeze(s)}function Oe(e,t){let n=[];if(null==t)throw new Error("lineId must not be null / undefined");const r=e.length;for(let i=0;i<r;++i){const r=e[i].lines,s=r.length;for(let e=0;e<s;++e){r[e]==t&&n.push([i,e])}}if(2!=n.length)throw new Error("line must be connected at 2 points, not "+n.length);return n}function je(e,t){return Oe(e,t).map(e=>e[0])}function xe(e,t,n){const r=e[t].lines[n];if(void 0===r)throw new Error("cannot find line with lineIndex = "+n);let i=Oe(e,r);return 0==l(i[0],[t,n],a)?i[1]:i[0]}function Ie(e,t,n){return xe(e,t,n)[0]}function ke(e,t,n){return l(xe(e,t,n),[t,n],a)>0}function Se(e,t,n,r){return e.map((e,t)=>({distance:Math.pow(n-e.x,2)+Math.pow(r-e.y,2),index:t})).sort((e,t)=>e.distance-t.distance).slice(0,t).map(e=>e.index)}const $e=Object.freeze({nodes:Object.freeze([]),superlines:Object.freeze({}),lines:Object.freeze({}),deltas:Object.freeze([])});function Ee(e){return Object.freeze(Object.assign({},$e,e))}function De(e,t,n,r,i){if(e==t||t==n||n==e)throw new Error("cannot create w3jDiagram with conflicting labels");return Ee({nodes:Object.freeze([be(e,e,r-50,i+50),be(t,t,r+50,i+50),be(n,n,r,i-70),ve(e,t,n,r,i)]),lines:Object.freeze({[e]:ae(e),[t]:ae(t),[n]:ae(n)}),superlines:Object.freeze({[e]:Q,[t]:Q,[n]:Q})})}function Pe(e,t,n){const r=e.lines;return Object.freeze(Object.assign({},e,{lines:Object.freeze(Object.assign({},r,{[t]:Object.freeze(Object.assign({},r[t],n))}))}))}function ze(e,t){const n=e.nodes[t];if("w3j"!=n.type)throw new Error("cannot get orientation of generic node");return c([0,1,2],n.lines.map((n,r)=>[r,d(function(e,t,n){const r=e.nodes[t].lines[n],i=e.lines[r],s=me(e,r),o=Number(ke(e.nodes,t,n));return(s.singular?i.angle:s.angle)+o*Math.PI+(o?1:-1)*s.arc.inclination}(e,t,r),2*Math.PI)]).sort((e,t)=>e[1]-t[1]).map(([e,t])=>e))}function Me(e,t){let n=x(e);n.superlines=se(e.superlines,t.superlines);let r={};Object.keys(t.lines).forEach((function(e){let i=e;for(;n.lines.hasOwnProperty(i);)i=te(i);r[e]=i,n.lines[i]=t.lines[e]}));let i=[];return t.nodes.forEach((function(e){"terminal"==(e=Object.assign({},e,{lines:e.lines.map(e=>r[e])})).type?i.push(e):n.nodes.push(e)})),n.nodes=i.concat(n.nodes),n}function Ne(e,t){for(const n of e.nodes)if("terminal"==n.type&&e.lines[n.lines[0]].superline==t)return!0;return!1}function Le(e,t){let n=(e=x(e)).lines[t];return n.direction>0?n.direction=-1:n.direction<0?n.direction=0:n.direction=1,e}function Ae(e,t){if("w3j"!=e.nodes[t].type)return e;let n=(e=x(e)).nodes[t].lines;n.reverse();for(let t=0;t<3;++t)if(n[t]==n[(t+1)%3]){e.lines[n[t]]=ce(e.lines[n[t]]);break}return e}function He(e,t){const n=Object.keys(e.lines);let r=n.length;for(;r--;)if(e.lines[n[r]].superline==t)return!1;return!0}function qe(e,t){return"w3j"!=e.nodes[t].type||(e=x(Ae(e,t))).nodes[t].lines.forEach(t=>e.superlines=se(e.superlines,{[e.lines[t].superline]:{phase:1}})),e}class Te{constructor(e,t,n){console.assert(e),this.diagram=e,this.id=t,this.reversed=Boolean(n),Object.freeze(this)}get rawLine(){return this.diagram.rawDiagram.lines[this.id]}get line(){return(this.reversed?ce:s)(this.diagram.rawDiagram.lines[this.id])}get superline(){return this.diagram.superline(this.superlineId)}get superlineId(){return this.line.superline}get direction(){return null==this.rawLine.direction?null:this.rawLine.direction*(1-2*this.reversed)}node(e){const t=this.diagram._lineEnds[this.id];return new Be(this.diagram,t[(this.reversed+e)%2*2])}lineIndex(e){return this.diagram._lineEnds[this.id][(this.reversed+e)%2*2+1]}cycNodeLine(e,t){return this.node(e).line((this.lineIndex(e)+t)%3)}toString(){return(this.reversed?"-":"+")+this.id}signedRebase(e){return e.signedLine(this.id,this.reversed)}reverse(){return new Te(this.diagram,this.id,!this.reversed)}concat(...e){return fe(e.map(e=>e.line))}static removeSign(e){const t=e.substr(1);let n=!1;if("-"==e[0])n=!n;else if("+"!=e[0])throw new Error("not a valid signed line ID: "+e);return[t,n]}rawAssign(e,t,n){e.nodes[this.node(t).index].lines[this.lineIndex(t)]=n}testCuttability(){let e=[Je(this),Je(this.reverse())].filter(s);return 2==e.length?(e.sort((e,t)=>e.priority-t.priority),e[0].error):null}}class Be{constructor(e,t){this.diagram=e,this.index=t,Object.freeze(this)}get rawNode(){return this.diagram.rawDiagram.nodes[this.index]}get type(){return this.rawNode.type}get variable(){if("terminal"!=this.type)throw new Error("node is not a terminal");return this.rawNode.variable}get numLines(){return this.rawNode.lines.length}line(e){const t=this.rawNode.lines[e],n=this.diagram._lineEnds[t],r=n[2]==this.index&&n[3]==e;return new Te(this.diagram,t,r)}lines(){return m(e=>this.line(e),g(0,this.numLines))}get xy(){return[this.rawNode.x,this.rawNode.y]}}class Re{constructor(e){this.rawDiagram=Object.freeze(e)||$e,this._cache={},Object.freeze(this)}static deserialize(e){return new Re(JSON.parse(e))}get serialize(){return JSON.stringify(this.rawDiagram)}get _lineEnds(){let e=this._cache.lineEnds;return e||(e=function(e){let t={};return e.nodes.forEach((e,n)=>{e.lines.forEach((e,r)=>{let i=t[e];if(i){if(2!=i.length)throw new Error("line must be connected to exactly 2 nodes");l([i[0],i[1]],[n,r],a)<0?t[e].push(n,r):t[e].splice(0,0,n,r)}else t[e]=[n,r]})}),t}(this.rawDiagram),this._cache.lineEnds=e),e}get terminals(){let e=this._cache.terminals;if(!e){e={};for(const t of this.nodes())if("terminal"==t.type){if(e[t.variable])throw new Error("duplicate terminal variables");e[t.variable]=t}this._cache.terminals=e}return e}terminal(e){return this.terminals[e]}get numNodes(){return this.rawDiagram.nodes.length}node(e){return new Be(this,e)}*nodes(){const e=this.numNodes;for(let t=0;t<e;++t)yield this.node(t)}get lineIds(){return Object.keys(this.rawDiagram.lines)}signedLine(e,t){const[n,r]=Te.removeSign(e);return this.line(n,r!=Boolean(t))}line(e,t){return new Te(this,e,t)}lines(){return m(e=>this.line(e),this.lineIds)}get superlines(){return this.rawDiagram.superlines}superline(e){return this.superlines[e]}hasSuperline(e){return!!this.superline(e)}isEquallyConstrained(e,t){return V([F(this.rawDiagram.deltas,e)],[F(t,e)])}renameLines(e){let t={};for(const n of Object.keys(this.rawDiagram.lines)){t[e.hasOwnProperty(n)?e[n]:n]=this.rawDiagram.lines[n]}const n=this.rawDiagram.nodes.map(t=>Object.freeze(Object.assign({},t,{lines:Object.freeze(t.lines.map(t=>j(e,t,t)))})));return new Re(Object.assign({},this.rawDiagram,{nodes:Object.freeze(n),lines:Object.freeze(t)}))}desumExposedSuperlines(){return new Re(Object.assign({},this.rawDiagram,{superlines:se(this.rawDiagram.superlines,...Object.entries(this.rawDiagram.superlines).map(([e,t])=>Ne(this.rawDiagram,e)?{[e]:{summed:!1}}:{}))}))}renameSuperlines(e){return new Re(Object.assign({},this.rawDiagram,{lines:Object.freeze(Object.assign({},...Object.entries(this.rawDiagram.lines).map(([t,n])=>({[t]:Object.freeze(Object.assign({},n,{superline:j(e,n.superline,n.superline)}))})))),superlines:se(...Object.entries(this.rawDiagram.superlines).map(([t,n])=>({[j(e,t,t)]:n}))),deltas:U(this.rawDiagram.deltas.map(t=>t.map(t=>j(e,t,t))))})).removeUnusedSuperlines().desumExposedSuperlines()}removeUnusedSuperlines(){let e=Object.assign({},this.rawDiagram.superlines);for(const n of Object.keys(e))((t=e[n]).phase||t.summed||t.weight)&&delete e[n];var t;for(const t of this.lines())delete e[t.superlineId];for(const t of this.rawDiagram.deltas)for(const n of t)delete e[n];let n=Object.assign({},this.rawDiagram.superlines);for(const t of Object.keys(e))delete n[t];return n[0]&&(n[0]=Q),new Re(Object.assign({},this.rawDiagram,{superlines:n}))}substitute(e,t,n){n=n||{},e=Ee(e),t=Ee(t);const r=this.rawDiagram,i=new Re(e);let o=new Re(t),u=[r.deltas,t.deltas];if(!W(r.deltas,e.deltas))throw new Error("mismatch in deltas");let d={},f={};for(const e of i.lines()){const t=Te.removeSign(e.id)[0],n=f[t];if(n){if("terminal"!=n.node(0).type&&"terminal"!=n.node(1).type||"terminal"!=e.node(0).type&&"terminal"!=e.node(1).type)throw new Error("a single internal line cannot match multiple lines");if("terminal"==e.node(0).type&&"terminal"==e.node(1).type)throw new Error("a lone pattern line cannot be shared");if(d[e.id]||d[n.id])throw new Error("looped lines can only appear twice");d[e.id]=n.id,d[n.id]=e.id}else f[t]=e}let p=Object.assign({},r.lines);for(const e of i.lines()){const t=Te.removeSign(e.id)[0];console.assert(p[t]||d[e.id]),delete p[t]}let h=ne(p),g={};for(const e of o.lines())(e.id.startsWith("$")||p.hasOwnProperty(e.id))&&(g[e.id]=h.next().value);o=o.renameLines(g),t=o.rawDiagram;let w=[r.superlines],v=new Set;for(const n of Object.keys(e.superlines)){const i=e.superlines[n],s=r.superlines[n];if(i.summed){if("0"!=n){if(!s.summed)throw new Error("expected summed superline");if(i.weight!=s.weight)throw new Error("weight of summed superline must match");if(i.phase!=s.phase)throw new Error("phase of summed superline must match");if(!this.isEquallyConstrained(n,t.deltas))throw new Error("deltas of summed superline must match");v.add(n)}w.push({[n]:{summed:!1}})}w.push({[n]:{weight:-i.weight,phase:-i.phase}})}for(const n of Object.keys(t.superlines)){if(t.superlines[n].summed){const t=e.superlines[n];if(t){if(!t.summed)throw new Error("summed variable conflicts with pattern")}else if(r.superlines[n])throw new Error("summed variable conflicts with original")}}w.push(t.superlines);for(const e of i.nodes()){if("terminal"==e.type)continue;if(0==e.numLines)throw new Error("singleton nodes are not supported");const t=e.line(0).signedRebase(this).node(0);if(t.type!=e.type)throw new Error("node type mismatch");const n=Array.from(t.rawNode.lines),r=Array.from(e.rawNode.lines);if("w3j"==t.type){const e=c(n,n),t=c(n,r.map(e=>Te.removeSign(e)[0]));if(e&&0==t)throw new Error("node lines mismatch");t<0&&w.push({[n[0]]:{phase:1}},{[n[1]]:{phase:1}},{[n[2]]:{phase:1}})}else if(0!=l(n,r,a))throw new Error("node lines mismatch")}let O=new Set;for(const e of i.lines()){const t=e.node(0),n=e.node(1),r=e.signedRebase(this);if(r.superlineId!=e.superlineId)throw new Error("superline ID mismatch in lines");if("terminal"!=t.type&&"terminal"!=n.type&&null!=e.direction){const t=de(r.direction,-e.direction);if("0"!=r.superlineId&&t%2!=0)throw new Error("directedness mismatch in lines");w.push({[r.superlineId]:{phase:t}})}O.add(r.id)}new Set(Object.keys(e.superlines));for(const e of this.lines())if(!O.has(e.id)&&v.has(e.superlineId))throw new Error("summed line must not appear outside match");let j=r.nodes.map(e=>Object.assign({},e,{lines:e.lines.slice()})),x=t.nodes.map(e=>Object.assign({},e,{lines:e.lines.slice()})),I={};const k=e=>{let t=[e.line];for(;;){const n=e.node(1),r={type:"replacement",lines:t,line:e,lineId:e.id,nodes:x};if("terminal"!=n.type)return r;const s=i.terminal(n.variable);if(!s)return r;I[e.id]=!0;const a=s.line(0),l=a.signedRebase(this).reverse();"terminal"==a.node(1).type&&a.reversed||t.push(a.line,l.line);const c=d[a.id];if(!c)return{type:"original",lines:t,line:l,lineId:e.id,nodes:j};const u=i.line(c,a.reversed),f=u.node(0);if("terminal"!=f.type)throw new Error("expected terminal node");if(t.push(u.reverse().line),e=o.terminal(f.variable).line(0),I[e.id])return{type:"cycle",lines:t};t.push(e.line)}};function S(e){switch(e.type){case"replacement":return"terminal"==e.line.node(1).type?-1:1;case"original":return 0;default:throw new Error("joining type not valid here")}}for(const e of o.lines()){if(I[e.id])continue;const t=k(e.reverse());if("cycle"==t.type){const e=pe(...t.lines);if(u.push([e.delta]),e.line.direction%2)throw new Error("directed loops are forbidden");w.push({[e.line.superline]:{phase:e.phase,weight:2}});continue}const n=k(e),r=t.lineId,i=t.line.node(1).index,o=n.line.node(1).index,c=t.line.lineIndex(1),d=n.line.lineIndex(1),f=t.lines.map(ce).reverse().concat(n.lines.slice(1)),h=l([S(t),i,c],[S(n),o,d],a)>0?ce:s;t.nodes[i].lines[c]=r,n.nodes[o].lines[d]=r;const g=pe(...f);u.push([g.delta]),console.assert(!p[r]);let m=g.line.superline;for(const e of g.delta)if(!this.superline(e)||!this.superline(e).summed){m=e;break}p[r]=le(h(Object.assign({},g.line,{superline:m}))),w.push({[g.line.superline]:{phase:g.phase}})}const $=Array.prototype.concat(t.nodes.filter((e,t)=>"terminal"==e.type&&!i.terminal(e.variable)),b(j,Array.from(m(e=>e.line(0).signedRebase(this).node(0).index,y(e=>"terminal"!=e.type,i.nodes())))),t.nodes.filter(e=>"terminal"!=e.type)),E=new Re(Object.assign({},r,{nodes:$,lines:p,superlines:se(...w),deltas:U(...u)})).removeUnusedSuperlines();return n.withLineRenames?{diagram:E,lineRenames:g}:E}}function _e(e){if("w3j"!=e.type)return"not a Wigner 3-jm symbol";for(let t=0;t<3;++t)if(e.line(t).id==e.line((t+1)%3).id)return{cutLine:e.line((t+2)%3),loopLine:e.line(t)};return"no loops found"}function Ce(e,t,n){const r=(e=new Re(e)).line(t).node(0);if(r.index!=e.line(t).node(1).index)return"no loops found";const i=_e(r);if("object"!=typeof i)return i;if(!ue(i.loopLine.line))return"loop must be directed";const s=i.cutLine.node(1);if("w3j"!=s.type)return(e=x(e.rawDiagram)).deltas=U(e.deltas,[[e.lines[i.cutLine.id].superline,"0"]]),e.lines[i.cutLine.id].superline="0",e.superlines[0]=Q,e;if(s.index!=n&&r.index!=n)return"not sure what you're trying to do";const o=i.loopLine,a=i.cutLine,l=i.cutLine.cycNodeLine(1,1).reverse(),c=i.cutLine.cycNodeLine(1,2).reverse();if(c.id==l.id&&!ue(c.line))return(e=x(e.rawDiagram)).deltas=U(e.deltas,[[e.lines[i.cutLine.id].superline,"0"]]),e.lines[i.cutLine.id].superline="0",e.superlines[0]=Q,e;const u=o.toString(),d=a.toString(),f=l.toString(),p=c.toString(),h=o.superlineId,g=a.superlineId,m=l.superlineId,y=c.superlineId;return e.substitute({nodes:[be(p,"a"),be(f,"b"),ve(u,u,d),ve(d,f,p)],lines:{[u]:{superline:h,direction:1},[d]:{superline:g,direction:null},[f]:{superline:m,direction:0},[p]:{superline:y,direction:1}},superlines:{[y]:{weight:1}}},{nodes:[be("$1","a"),be("$1","b")],lines:{$1:{superline:m,direction:0,arcHeight:-8*l.line.arcHeight}},superlines:{[h]:{weight:1},0:{}},deltas:[["0",g]]}).rawDiagram}function Xe(e,t,n,r,i){let s=(e=new Re(e)).line(t),o=e.line(n);E($(s.node(1).xy,s.node(0).xy),$(o.node(1).xy,o.node(0).xy))<0!=Boolean(r)&&(o=o.reverse());const a=S(D(.375,S(s.node(0).xy,o.node(0).xy)),D(.125,S(s.node(1).xy,o.node(1).xy))),l=S(D(.125,S(s.node(0).xy,o.node(0).xy)),D(.375,S(s.node(1).xy,o.node(1).xy))),c=re(e.rawDiagram).next().value,u=s.node(0).index==o.node(0).index?50:0,d=s.node(1).index==o.node(1).index?50:0;return e.substitute({nodes:[be(s.toString(),"a"),be(s.toString(),"b"),be(o.toString(),"c"),be(o.toString(),"d")],lines:{[s]:{superline:s.superlineId,direction:0},[o]:{superline:o.superlineId,direction:0}}},{nodes:[be("$1","a"),be("$2","b"),be("$3","c"),be("$4","d"),ve("$1","$3","$5",...a),ve("$2","$4","$5",...l)],lines:{$1:{superline:s.superlineId,direction:Number(i),arcHeight:-u},$2:{superline:s.superlineId,direction:Number(i),arcHeight:-d},$3:{superline:o.superlineId,direction:0,arcHeight:u},$4:{superline:o.superlineId,direction:0,arcHeight:d},$5:{superline:c,direction:0}},superlines:{[c]:{phase:0,weight:2,summed:!0}}}).rawDiagram}function Ye(e,t){let n=[],r=new M;for(const i of e.lines())"0"!=i.superlineId&&([i.node(0).type,i.node(1).type].includes("terminal")&&(t||i.direction%2==0)&&n.push(i.id),r.set(i.id,1-d(i.direction,2)));let i=new A;for(const t of e.nodes())if("w3j"==t.type)for(const e of t.lines())"0"!=e.superlineId&&i.modify(e.id,t.index,t=>t+(e.reversed?-1:1));let s=r.copy(),o=i.map(e=>d(e,2));for(const e of n)s.delete(e),o.deleteRow(e);const a=function(e,t,n){t=t.copy(),n=n.copy();let r=new Set(t.rowKeys()),i=Array.from(t.colKeys()).reverse(),s=[],o=[];for(const e of n.keys())r.add(e);for(;i.length;){const a=i.pop();let l,c=null;for(const n of r)if(l=t.get(n,a),!e.eq(l,e.ZERO)){c=n;break}if(null==c){s.push(a);continue}o.push([c,a]),r.delete(c);const u=e.divide(e.ONE,l);for(const n of i)t.modify(c,n,t=>e.multiply(u,t));n.modify(c,t=>e.multiply(u,t));for(const s of r){const r=t.get(s,a);if(!e.eq(r,e.ZERO)){for(const n of i)t.modify(s,n,i=>e.subtract(i,e.multiply(r,t.get(c,n))));n.modify(s,t=>e.subtract(t,e.multiply(r,n.get(c))))}}}let a=!0;for(const t of r)if(!e.eq(n.get(t),e.ZERO)){a=!1;break}let l=new n.constructor;for(const t of i)l.set(t,e.ZERO);for(const t of s)l.set(t,e.ZERO);o.reverse();for(const[r,[i,s]]of o.entries()){let a=n.get(i);for(const[n,[s,c]]of o.entries()){if(n>=r)break;a=e.subtract(a,t.get(i,c)*l.get(c))}l.set(s,a)}return{consistent:a,solution:l,unconstrained:s}}(z,o,s),l=function(e,t,n){let r=new n.constructor;for(const[i,s]of t.rows()){let t=e.ZERO;for(const[r,i]of s)t=e.add(t,e.multiply(s.get(r),n.get(r)));r.set(i,t)}return r}(P,i,a.solution.map(e=>-e));return{orientable:a.consistent,directions:l,target:s}}function Je(e){const t=function(e){let t=!0,n=!0,r=new Set,i={},s=[e];for(;s.length>0;){const o=s.pop();if(i.hasOwnProperty(o.id)){o.id==e.id&&o.reversed==e.reversed&&(n=!1);continue}const a=o.node(1);"terminal"==a.type&&(t=!1),r.add(a.index),i[o.id]=o.rawLine;for(const e of a.lines())s.push(e)}const o=e.diagram.rawDiagram;return{closed:t,isolated:n,diagram:Object.assign({},o,{nodes:o.nodes.filter((e,t)=>r.has(t)),lines:i})}}(e);if(!t.isolated)return{error:"only bridges can be cut",priority:1};if(!t.closed)return{error:"subdiagram must be closed",priority:2};const n=Object.assign({},t.diagram);n.lines=Object.assign({},n.lines),n.lines[e.id]=Object.assign({},n.lines[e.id],{superline:"0"});return Ye(new Re(n),!0).orientable?null:{error:"diagram is non-orientable",priority:0}}function Ke(e,t,n,r){const i=t.snapshot.diagram,s=i.lines[n],o=i.superlines[s.superline],a=me(i,n),l=we(a,s.textPos,0);let c=s.textOffset;0==c?c=20*a.halfDisk:c>0&&c<20?c=20:c<0&&c>-20&&(c=-20);let u=`M ${a.x0} ${a.y0} `;if(a.arc.radius==1/0)u+="L ";else{const e=Math.abs(a.arc.radius);u+=`A ${e} ${e} 0 ${Number(a.arc.large)} ${Number(a.arc.sweep)} `}u+=`${a.x1} ${a.y1}`;const h=l.x+c*l.normalX,g=l.y+c*l.normalY;function m(t){const[r,i]=ct([t.clientX,t.clientY]);1==t.buttons?(e(It(r,i,{superficial:!0},(e,t,r,i)=>{let s;if(a.singular){const e=t-a.xMid,n=r-a.yMid,o=Math.atan2(n,e)-Math.PI/2,l=Math.sqrt(e*e+n*n);s={angle:p(i&&Math.PI/6,o),arcHeight:f(20,1/0,p(i&&20,l))}}else s={angle:a.trueAngle,arcHeight:p(i&&20,k(t,r,a.x0,a.y0,a.x1,a.y1))};return Pe(e,n,s)})),t.stopPropagation()):2==t.buttons&&1==t.ctrlKey&&(e(dt({superficial:!0},e=>a.singular?e:Pe(e,n,{angle:a.angle,arcHeight:0}))),t.stopPropagation())}return J("svg:g",{[q]:n,class:"line "+("0"==s.superline?"zero ":"")+(o.summed?"summed ":"")+(o.phase%2?"one-j ":"")+(d(o.phase,4)>=2?"two-j ":"")+("line"==t.trackStart.type&&t.trackStart.lineId==n||"line"==t.trackStop.type&&t.trackStop.lineId==n?t.trackType+" ":""),onmouseenter:function(t){e(mt({type:"line",lineId:n}))},onmouseleave:function(t){e(mt({type:null}))}},J("svg:title",{},`j[${s.superline}] m[${n}]`),J("svg:path",{class:"bg",d:u,onmousedown:m}),J("svg:path",{class:"fg",d:u,onmousedown:m}),J("svg:path",{class:"pith",d:u,onmousedown:m}),J("svg:path",{class:"hit",d:u,onmousedown:m}),J("svg:text",{class:"label",x:h,y:g,onmousedown:function(t){1==t.buttons?(e(It(h,g,{superficial:!0},(e,t,r,i)=>{const s=ye(a,t,r);return Pe(e,n,{textPos:f(.1,.9,p(i&&.1,s.pos)),textOffset:p(i&&10,s.offset)})})),t.stopPropagation()):2==t.buttons&&1==t.ctrlKey&&(e(dt({superficial:!0},e=>Pe(e,n,{textPos:.5,textOffset:0}))),t.stopPropagation())}},s.superline),...function(e,t,n,r){const i=t.lines[n];let s=!1,o=!1,a=i.direction;if(r){o=r.target.get(n);const e=r.directions.get(n);s=!a==!e,a=a||e}if(0==a&&!o)return[];i.arrowPos<0?i.arrowPos=0:i.arrowPos>1&&(i.arrowPos=1);const l=me(t,n),c=15*a/2,u=we(l,i.arrowPos,c),d=we(l,i.arrowPos,0),h=u.tangentAngle+Number(a<0)*Math.PI;return[J("svg:g",{class:"arrow "+(i.direction?"":"ambient ")+(l.external?"external ":"")+(s?"bad ":""),onmousedown:function(t){1==t.buttons?(e(It(d.x,d.y,{superficial:!0},(e,t,r,i)=>{const s=ye(l,t,r).pos;let o=Object.assign({},e.lines);return o[n]=Object.assign({},o[n],{arrowPos:f(.1,.9,p(i&&.1,s))}),Object.assign({},e,{lines:o})})),t.stopPropagation()):2==t.buttons&&t.ctrlKey&&(e(dt({superficial:!0},e=>{let t=Object.assign({},e.lines);return t[n]=Object.assign({},t[n],{arrowPos:.5}),Object.assign({},e,{lines:t})})),t.stopPropagation())}},J("svg:circle",{class:"hit",r:15,cx:d.x,cy:d.y}),a?J("svg:use",{class:"arrowhead",href:"#arrowhead",x:-15,y:-7.5,width:15,height:15,transform:`translate(${u.x}, ${u.y}) rotate(${180*h/Math.PI})`}):J("svg:circle",{class:"arrowhead",cx:u.x,cy:u.y,r:7.5}))]}(e,i,n,r))}function Ue(e,t,n,r){const i=t.snapshot.diagram,s=i.nodes[n];let o=[J("svg:title",{},"w3j"==s.type?`{${s.lines.join(" ")}} #${n}`:"terminal"==s.type?`m[${s.variable}] #${n}`:s.type)];if("w3j"==s.type){const e=30,t=ze(i,n)>0?"flipped ":"";o.push(J("svg:circle",{class:"bg "+t,r:20})),o.push(J("svg:circle",{class:"fg "+t,r:18})),o.push(J("svg:circle",{class:"hit "+t,r:25})),o.push(J("svg:use",{class:"arrow "+t,href:"#clockwise",x:-e/2,y:-e/2,width:e,height:e}))}else if("terminal"==s.type){const e=r?"frozen ":"";o.push(J("svg:circle",{class:"fg "+e,r:8})),o.push(J("svg:circle",{class:"hit",r:15}))}else o.push(J("svg:circle",{class:"fg",r:20})),o.push(J("svg:circle",{class:"hit",r:25})),o.push(J("svg:text",{class:"label"}));return J("svg:g",{[q]:(a=s,O.has(a)||O.set(a,++v),O.get(a)),class:"node "+s.type+" "+("node"==t.trackStart.type&&t.trackStart.nodeIndex==n||"node"==t.trackStop.type&&t.trackStop.nodeIndex==n?t.trackType+" ":""),transform:`translate(${s.x}, ${s.y})`,onmouseenter:function(t){e(mt({type:"node",nodeIndex:n}))},onmouseleave:function(t){e(mt({type:null}))},onmousedown:function(t){if(1==t.buttons)e(It(s.x,s.y,{superficial:"w3j"==s.type},(e,t,r,i)=>function(e,t,n){const r=e.nodes;return Object.freeze(Object.assign({},e,{nodes:Object.freeze(Object.assign([],r,{[t]:Object.freeze(Object.assign({},r[t],n))}))}))}(e,n,{x:p(i&&20,t),y:p(i&&20,r)}))),t.stopPropagation();else if(4==t.buttons){if("terminal"==s.type)return;t.shiftKey?e(dt({equivalent:!0},e=>qe(qe(e,n),n))):e(dt({equivalent:!0},e=>qe(e,n))),t.stopPropagation()}else if(2==t.buttons){if("terminal"==s.type)return;e(dt({equivalent:!0},e=>function(e,t){const n=new Re(e);let r=(e=x(e)).nodes[t];if("w3j"!=r.type)return e;const i=_e(n.node(t));let s=null;"object"==typeof i&&(s=i.loopLine.id);let o=0;return r.lines.forEach((function(n,r){const i=e.lines[n];ke(e.nodes,t,r)?o-=i.direction:o+=i.direction})),0==o?o=1:-3==o?o=-2:o/=Math.abs(o),r.lines.forEach((function(n,r){let i=Object.assign({},e.lines[n]);ke(e.nodes,t,r)?i.direction+=o:i.direction-=o,e.lines[n]=i})),r.lines.forEach((function(t,n){const r=e.lines[t],i=he(r);e.lines[t]=i.line,e.superlines=se(e.superlines,{[r.superline]:{phase:i.phase}})})),e}(e,n))),t.stopPropagation()}}},...o);var a}function We(e,t){if("0"==e)return"0"==t?0:-1;if("0"==t)return 1;let n=e.length-t.length;return 0==n&&(n=Number(e>t)-Number(e<t)),n}const Ve={"Α":"A","α":"\\alpha","Β":"B","β":"\\beta","Γ":"\\Gamma","γ":"\\gamma","Δ":"\\Delta","δ":"\\delta","Ε":"E","ε":"\\varepsilon","ϵ":"\\epsilon","Ζ":"Z","ζ":"\\zeta","Η":"H","η":"\\eta","Θ":"\\Theta","θ":"\\theta","ϑ":"\\vartheta","Ι":"I","ι":"\\iota","Κ":"K","κ":"\\kappa","ϰ":"\\varkappa","Λ":"\\Lambda","λ":"\\lambda","Μ":"M","μ":"\\mu","Ν":"N","ν":"\\nu","Ξ":"\\Xi","ξ":"\\xi","Ο":"O","ο":"o","Π":"\\Pi","π":"\\pi","ϖ":"\\varpi","Ρ":"P","ρ":"\\rho","ϱ":"\\varrho","Σ":"\\Sigma","σ":"\\sigma","ς":"\\varsigma","Τ":"T","τ":"\\tau","Υ":"Y","ϒ":"\\Upsilon","υ":"\\upsilon","Φ":"\\Phi","φ":"\\varphi","ϕ":"\\phi","Χ":"X","χ":"\\chi","Ψ":"\\Psi","ψ":"\\psi","Ω":"\\Omega","ω":"\\omega"},Ze="ΑαΒβΓγΔδΕεϵΖζΗηΘθϑΙιΚκϰΛλΜμΝνΞξΟοΠπϖΡρϱΣσςΤτΥϒυΦφϕΧχΨψΩω",Fe=`['′_.,\\w${Ze}]`;function Ge(e){return!!new RegExp(`^${Fe}+$`).exec(e)}function Qe(e){return"w3j"==e.node(0).type&&e.node(0).index==e.node(1).index&&("0"==e.superlineId||e.direction%2)}function et(e,t,n){const r=n.snapshot.frozen,i=n.focus;return Array.from(new Set(Object.keys(t).concat("0"))).sort(We).map(s=>{const o="tableauJName"==i.type&&i.superlineId==s,a="0"==s?Q:t[s],l=J("span",{class:"two-j"},"••");let c;switch(d(a.phase,4)){case 0:c=["   "];break;case 1:c=["•  "];break;case 2:c=[l," "];break;case 3:c=[l,"•"]}let u=a.weight?(a.weight>0?"+":a.weight<0?"−":"")+Math.abs(a.weight):"";return J("tr",{},J("td",{class:"summed",onmousedown:function(t){1==t.buttons?(e(ft(e=>function(e,t){if("0"==t)return"";if(Ne(e,t))return"";const n=e.superlines[t];if(n.summed){const n=Z(e.deltas,t);if(n){const r=e.deltas,i=r[n[0]][(n[1]+1)%r[n[0]].length],s=e.superlines[t].summed&&e.superlines[i].summed;return e=new Re(e).renameSuperlines({[t]:i}).rawDiagram,(e=Object.assign({},e)).superlines=Object.assign({},e.superlines),e.superlines[i]=Object.assign({},e.superlines[i],{summed:s}),{equivalent:!0,diagram:e}}}return(e=x(e)).superlines[t].summed=!n.summed,{equivalent:!1,diagram:e}}(e,s))),t.stopPropagation()):4==t.buttons&&(e(ft(e=>function(e,t){const n=re(e).next().value;return(e=x(e)).superlines[n]=Object.assign({},Q,{summed:!0}),e.deltas=U(e.deltas,[[t,n]]),{equivalent:!0,diagram:e}}(e,s))),t.stopPropagation())}},a.summed?"∑":""),J("td",{class:"name",contenteditable:"0"!=s,spellcheck:"false",[T]:o,onfocus:function(t){e(yt({type:"tableauJName",superlineId:s}))},onblur:function(t){let n=this.textContent;n=n.trim(),n||(n="0"),e(e=>{ft(e=>{if(e=new Re(e),s==n||!Ge(n))return"";const t=e.superline(s),i=e.rawDiagram.deltas;if(r&&0==t.phase&&!t.summed&&!Z(i,s)){let r=0;for(const t of e.lines())if(t.superlineId==s){if(!Qe(t)){r=null;break}r+=1}if(null!=r&&t.weight==-r)return{equivalent:!0,diagram:e.renameSuperlines({[s]:n}).rawDiagram}}return{equivalent:t.summed&&!e.superline(n),diagram:e.renameSuperlines({[s]:n}).rawDiagram}})(e),wt(e)})}},"0"==s?J("span",{class:"zero"},"0"):s),J("td",Object.assign({class:"phase "+("phase"==n.drag.type&&n.drag.superlineId==s?"drag ":"")+("phase"==n.drop.type&&n.drop.superlineId==s?"drop ":""),oncontextmenu:function(e){e.preventDefault()},onmousedown:function(t){2==t.buttons?(e(dt({},e=>Object.assign({},e,{superlines:se(e.superlines,{[s]:{phase:1}})}))),t.stopPropagation(),t.preventDefault()):4==t.buttons&&(e(dt({},e=>Object.assign({},e,{superlines:se(e.superlines,{[s]:{phase:-1}})}))),t.stopPropagation(),t.preventDefault())}},bt(e,(e,t)=>({type:"phase",superlineId:s})),vt(e,(e,t)=>"phase"!=e.drag.type||e.drag.superlineId==s||e.snapshot.frozen&&!W(e.snapshot.diagram.deltas,[[e.drag.superlineId,s]])?null:{type:"phase",superlineId:s},(e,t)=>{ft(t=>({equivalent:W(t.deltas,[[e.drag.superlineId,s]]),diagram:t=Object.assign({},t,{superlines:se(t.superlines,{[e.drag.superlineId]:{phase:-1},[s]:{phase:1}})})}))(e)})),...c),J("td",Object.assign({class:"weight "+("weight"==n.drag.type&&n.drag.superlineId==s?"drag ":"")+("weight"==n.drop.type&&n.drop.superlineId==s?"drop ":""),oncontextmenu:function(e){e.preventDefault()},onmousedown:function(t){2==t.buttons?(e(dt({},e=>Object.assign({},e,{superlines:se(e.superlines,{[s]:{weight:1}})}))),t.stopPropagation(),t.preventDefault()):4==t.buttons&&(e(dt({},e=>Object.assign({},e,{superlines:se(e.superlines,{[s]:{weight:-1}})}))),t.stopPropagation(),t.preventDefault())}},bt(e,(e,t)=>({type:"weight",superlineId:s})),vt(e,(e,t)=>"weight"!=e.drag.type||e.drag.superlineId==s||e.snapshot.frozen&&!W(e.snapshot.diagram.deltas,[[e.drag.superlineId,s]])?null:{type:"weight",superlineId:s},(e,t)=>{ft(t=>({equivalent:W(t.deltas,[[e.drag.superlineId,s]]),diagram:t=Object.assign({},t,{superlines:se(t.superlines,{[e.drag.superlineId]:{weight:-1},[s]:{weight:1}})})}))(e)})),u))})}function tt(e,t){return n=>{const r=n.deltas;let i=null;if((n=Object.assign({},n)).deltas=r.slice(),n.deltas.splice(e,1,...t.split(/[;\n]/).map(e=>e.split("=").map(e=>((e=e.trim())&&!Ge(e)&&(i=e),e)).filter(s))),null!=i)return"invalid label: "+i;n.deltas=U(n.deltas),n.superlines=Object.assign({},n.superlines);for(const e of n.deltas)for(const t of e)n.superlines[t]||(n.superlines[t]=Q);const o=function(e){let t=[],n=new Set(["0"]);e=new Re(e);for(const r of e.nodes()){const e=_e(r);if("object"==typeof e&&e.loopLine.direction%2&&n.add(e.cutLine.superlineId),"w3j"==r.type)for(const e of r.lines())if(n.has(e.superlineId)){t.push([e.cycNodeLine(0,1).superlineId,e.cycNodeLine(0,2).superlineId]);break}}return t.push(Array.from(n)),t}(n),a=U(o,r),l=U(o,n.deltas);let c=V(a,l);if(n=new Re(n),!c){const e=new Set(F(a,"0")),t=new Set(F(l,"0"));let r=new Set([...e,...t].filter(n=>!e.has(n)||!t.has(n)));const i=["0",...r];if(V(U([i],a),U([i],l))){for(const e of n.lines())r.has(e.superlineId)&&!e.testCuttability()&&r.delete(e.superlineId);c=0==r.size}}return{equivalent:c,diagram:n.removeUnusedSuperlines().rawDiagram}}}function nt(e){return"0"==e?J("span",{class:"zero"},"0"):String(e)}function rt(e,t,n,r){return J("ul",{},...t.concat([null]).map((t,r)=>{const i="delta"==n.type&&n.deltaIndex==r,s=null==t?[J("i",{},"(create δ)")]:function(e,t){const n=t.length;let r=[];for(let i=0;i<n;++i)0!=i&&r.push(e),r.push(t[i]);return r}(" = ",Array.from(t).map(nt));return J("li",{class:null==t?"tip ":"",contenteditable:"true",spellcheck:"false",[T]:i,onmousedown:function(t){4==t.buttons&&(e(ft(tt(r,""))),t.preventDefault())},onfocus:function(n){if(null==t){this.textContent="";let e=document.createRange();e.selectNodeContents(this);let t=window.getSelection();t.removeAllRanges(),t.addRange(e)}e(yt({type:"delta",deltaIndex:r}))},onblur:function(t){const n=this.textContent;e(e=>{ft(tt(r,n))(e),wt(e)})}},...s)}))}function it(e,t){return"j"==e&&"0"==t?"0":`${e}_{${t=t.replace("′","'").replace("_","\\_").replace(new RegExp(`[${Ze}]`),e=>Ve[e]+" ")}}`}function st(e,t,n,r){const i=e.nodes[t].lines[n],s=e.lines[i],o=Ie(e.nodes,t,n),a=e.nodes[o],l=it("m","terminal"==a.type?a.variable:i),c={j:it("j",e.lines[i].superline),m:o<t&&0!=s.direction?"-"+l:l};return s.superline.summed&&(r.js[c.j]=!0),"terminal"!=a.type&&(r.ms[l]=!0),c}const ot={diagram:$e,frozen:!1,showAmbient:!0};function at(){return{snapshot:ot,savedSnapshot:ot,savedHash:"",staleEquation:!0,error:"",notice:"An editor for angular momentum diagrams",hover:{type:null},focus:{type:null},drag:{type:null},drop:{type:null},mouseX:null,mouseY:null,trackType:null,trackStart:{type:null,xy:null},trackStop:{type:null,xy:null}}}function lt(e){const t=window.location.hash;t.length<3?Object.assign(e,at()):e.savedHash!=t&&(e.snapshot=JSON.parse(decodeURIComponent(t.substr(1))),e.staleEquation=!0,e.savedSnapshot=e.snapshot,e.savedHash=t)}function ct(e){if(!e)return e;const t=document.getElementById("diagram").getBoundingClientRect();return[e[0]-t.left,e[1]-t.top]}function ut(e,t){const n=t.snapshot.diagram;let r=null;return t.snapshot.showAmbient&&(r=Ye(new Re(n),!1),r.orientable||(r=Ye(new Re(n),!0))),[{element:window,attributes:{onhashchange:t=>e(lt),onkeydown:t=>e($t.bind(null,t)),onmousemove:t=>{return e((n=t,e=>{const t=document.getElementById("diagram").getBoundingClientRect();var r,i;e.rawMouseX=n.clientX,e.rawMouseY=n.clientY,e.mouseX=n.clientX-t.left,e.mouseY=n.clientY-t.top,e.dragger?(dt(Object.assign({},e.draggerFlags,{transient:!0}),t=>e.dragger(t,n.clientX+e.dragOffsetX,n.clientY+e.dragOffsetY,n.ctrlKey))(e),n.stopPropagation()):function(e){return t=>{null!=t.trackStart.xy&&(t.trackStop.xy=[e.clientX,e.clientY],null!=t.trackStart.type&&("line"==t.hover.type?(t.trackStop.type="line",t.trackStop.lineId=t.hover.lineId):"node"==t.hover.type?(t.trackStop.type="node",t.trackStop.nodeIndex=t.hover.nodeIndex):t.trackStop.type=null))}}(n)(e),r=n.target,i=xt,(r[B]||{})[i]||null!=e.focus.type||n.preventDefault()}));var n},onmouseup:t=>{return e((n=t,e=>{e.dragger?(dt(e.draggerFlags,s)(e),e.dragger=null):function(e,t){(function(e,t){if(null==e.trackStop.xy||e.trackStart.type==e.trackStop.type&&e.trackStart.nodeIndex==e.trackStop.nodeIndex&&e.trackStart.lineId==e.trackStop.lineId&&E(n=$(e.trackStart.xy,e.trackStop.xy),n)<10){if("line"==e.trackStart.type){if("track2"==e.trackType)return void(e.snapshot.frozen?dt({equivalent:!0},t=>function(e,t){return"0"==e.lines[t].superline?(e=x(e)).lines[t].direction=(e.lines[t].direction+2)%3-1:e.lines[t].direction&&((e=x(e)).lines[t].direction*=-1,e.superlines=se(e.superlines,{[e.lines[t].superline]:{phase:2}})),e}(t,e.trackStart.lineId))(e):dt({},t=>Le(t,e.trackStart.lineId))(e));if("track1"==e.trackType){const t=e.trackStart.lineId;return void(e.snapshot.frozen?dt({equivalent:!0},e=>{const n=function(e,t){let n=new Re(e).line(t);if(!Qe(n))return null;if(jt(e,t))return e;const r=re(e=Object.assign({},e)).next().value,i=e.lines[t].superline;0==n.lineIndex(0)&&2==n.lineIndex(1)&&(n=n.reverse()),e.lines=Object.assign({},e.lines,{[t]:Object.assign({},e.lines[t],{direction:n.reversed?-1:1,superline:r})});const s=-1==n.direction?2:0;return e.superlines=se(e.superlines,{[i]:ee({weight:1,phase:s}),[r]:ee({weight:-1})}),new Re(e).removeUnusedSuperlines().rawDiagram}(e,t);if(n)return n;const r=Object.assign({},e.lines[t]),i=Z(e.deltas,r.superline);if(!i)return e;const[s,o]=i;return r.superline=e.deltas[s][(o+1)%e.deltas[s].length],Object.assign({},e,{lines:Object.assign({},e.lines,{[t]:r})})})(e):dt({},e=>{if(jt(e,t))return e;const n=re(e=Object.assign({},e)).next().value;return e.lines=Object.assign({},e.lines,{[t]:Object.assign({},e.lines[t],{superline:n})}),e.superlines=se(e.superlines,{[n]:Q}),e})(e))}}}else{const n=ct(e.trackStop.xy),r=ct(e.trackStart.xy);"track1"==e.trackType?"line"==e.trackStop.type?e.trackStart.lineId==e.trackStop.lineId?dt({equivalent:!0,clearHover:!0},t=>function(e,t){const n=(e=new Re(e)).line(t),r=n.superline;if(!r.summed)return`j[${n.superlineId}] must be summed over`;if(0!=r.phase)return`j[${n.superlineId}] must not have any phases`;if(2!=r.weight)return`weight of j[${n.superlineId}] must be exactly 2`;if(!e.isEquallyConstrained(n.superlineId,[]))return`j[${n.superlineId}] must not be constrained by deltas`;for(const t of e.lines())if(t.id!=n.id&&t.superlineId==n.superlineId)return`j[${n.superlineId}] must not appear anywhere else`;if("w3j"!=n.node(0).type||"w3j"!=n.node(1).type)return"expected Wigner 3-j symbols";const i=n.cycNodeLine(0,1).reverse(),s=n.cycNodeLine(1,1).reverse(),o=n.cycNodeLine(0,2).reverse(),a=n.cycNodeLine(1,2).reverse();if(i.superlineId!=s.superlineId||o.superlineId!=a.superlineId)return"opposing j's don't match";const l=i.id==o.id?a.id:o.id;return console.assert(i.id,l),e.substitute({nodes:[be(i.toString(),"a"),be(s.toString(),"b"),be(o.toString(),"c"),be(a.toString(),"d"),ve(i.toString(),o.toString(),n.toString()),ve(s.toString(),a.toString(),n.toString())],lines:{[i]:{superline:i.superlineId,direction:0},[s]:{superline:s.superlineId,direction:0},[o]:{superline:o.superlineId,direction:0},[a]:{superline:a.superlineId,direction:0},[n]:{superline:n.superlineId,direction:0}},superlines:{[n.superlineId]:{phase:0,weight:2,summed:!0}}},{nodes:[be(i.id,"a"),be(i.id,"b"),be(l,"c"),be(l,"d")],lines:{[i.id]:{superline:i.superlineId,direction:0},[l]:{superline:o.superlineId,direction:0}}}).rawDiagram}(t,e.trackStart.lineId))(e):dt({equivalent:!0,clearHover:!0},t=>function(e,t,n,r,i){const s=(e=new Re(e)).line(t),o=e.line(n);return s.id==o.id?e:e.substitute({nodes:[be(s.toString(),"a"),be(s.toString(),"b"),be(o.toString(),"c"),be(o.toString(),"d")],lines:{[s]:{superline:s.superlineId,direction:1},[o]:{superline:o.superlineId,direction:1}}},{nodes:[be("$1","a"),be("$2","b"),be("$3","c"),be("$4","d"),ve("$1","$2","$5",r[0],r[1]),ve("$3","$4","$5",i[0],i[1])],lines:{$1:{superline:s.superlineId,direction:0},$2:{superline:s.superlineId,direction:0},$3:{superline:o.superlineId,direction:0},$4:{superline:o.superlineId,direction:0},$5:{superline:"0",direction:0}},superlines:se({[s.superlineId]:{weight:1}},{[o.superlineId]:{weight:1}})}).rawDiagram}(t,e.trackStart.lineId,e.trackStop.lineId,r,n))(e):"line"==e.trackStart.type&&dt({equivalent:!0,clearHover:!0},t=>function(e,t,n,r){const i=(e=new Re(e)).line(t),s=$(r,n),o=Math.atan2(s[1],s[0]);return e.substitute({nodes:[be(i.toString(),"a"),be(i.toString(),"b")],lines:{[i]:{superline:i.superlineId,direction:0}}},{nodes:[be("$1","a"),be("$2","b"),ve("$4","$4","$3",...r),ve("$3","$2","$1",...n)],lines:{$4:{superline:"0",direction:1,angle:o-.5*Math.PI,arcHeight:50},$3:{superline:"0",direction:0},$2:{superline:i.superlineId,direction:0,arcHeight:-i.line.arcHeight/4},$1:{superline:i.superlineId,direction:1,arcHeight:-i.line.arcHeight/2}},superlines:{[i.superlineId]:{weight:1}}}).rawDiagram}(t,e.trackStart.lineId,r,n))(e):"track2"==e.trackType&&("line"==e.trackStop.type?e.trackStart.lineId==e.trackStop.lineId?dt({equivalent:!0,clearHover:!0},t=>function(e,t,n,r){const i=(e=new Re(e)).line(t);if(E($(n,r),$(i.node(0).xy,i.node(1).xy))<0&&([n,r]=[r,n]),"0"!=i.superlineId){let e=i.testCuttability();if(e)return e}const s=$(n,r),o=Math.atan2(s[1],s[0]),a=e.substitute({nodes:[be(i.toString(),"a"),be(i.toString(),"b")],lines:{[i]:{superline:i.superlineId,direction:0}}},{nodes:[be("$1","a"),be("$2","b"),ve("$1","$3","$3",n[0],n[1]),ve("$2","$4","$4",r[0],r[1])],lines:{$1:{superline:i.superlineId,direction:0,arcHeight:-.5*i.line.arcHeight},$2:{superline:i.superlineId,direction:0,arcHeight:-.25*i.line.arcHeight},$3:{superline:"0",direction:0,angle:o+.5*Math.PI,arcHeight:50},$4:{superline:"0",direction:0,angle:o+1.5*Math.PI,arcHeight:50}},deltas:[["0",i.superlineId]]},{withLineRenames:!0});e=a.diagram.rawDiagram;const l=a.lineRenames,c=a.diagram.line(l.$3).id,u=a.diagram.line(l.$4).id;let d=Ce(e,c,a.diagram.line(c).node(0).index);return"string"==typeof d?e:(d=Ce(e=d,u,new Re(e).line(u).node(0).index),"string"==typeof d?e:d)}(t,e.trackStart.lineId,r,n))(e):dt({equivalent:!0,clearHover:!0},n=>{let r;for(const i of[!1,!0])if(r=Xe(n,e.trackStart.lineId,e.trackStop.lineId,t.shiftKey,i),Ye(new Re(r),!0).orientable)return r;return r})(e):"node"==e.trackStop.type&&dt({equivalent:!0,clearHover:!0},t=>Ce(t,e.trackStart.lineId,e.trackStop.nodeIndex))(e))}var n})(e,t),e.trackType=null,e.trackStart={type:null,xy:null},e.trackStop={type:null,xy:null}}(e,n),n.stopPropagation(),n.preventDefault()}));var n}}},{element:document.getElementsByTagName("body")[0],attributes:{class:t.snapshot.frozen?"frozen":""}},{element:document.getElementById("notice"),attributes:{class:t.error?"warning":""},children:[t.error||t.notice]},{element:document.getElementById("freeze"),attributes:{class:t.snapshot.frozen?"active":""}},{element:document.getElementById("ambient"),attributes:{class:t.snapshot.showAmbient?"active":""}},{element:document.getElementById("diagram"),attributes:{oncontextmenu:function(e){e.preventDefault()},onmousedown:t=>{4==t.buttons?(e(Ot(t,"track1")),t.stopPropagation()):2==t.buttons&&(e(Ot(t,"track2")),t.stopPropagation())}}},{element:document.getElementById("diagram-lines"),children:Object.keys(n.lines).map(n=>Ke(e,t,n,r))},{element:document.getElementById("diagram-nodes"),children:n.nodes.map((n,r)=>Ue(e,t,r,t.snapshot.frozen))},{element:document.getElementById("diagram-track"),children:null!=t.trackStop.xy?(i=t.trackType,o=ct(t.trackStart.xy),a=ct(t.trackStop.xy),[J("svg:circle",{class:i,cx:o[0],cy:o[1],r:8}),J("svg:path",{class:i,d:`M ${o[0]} ${o[1]} L ${a[0]} ${a[1]} `}),J("svg:circle",{class:i,cx:a[0],cy:a[1],r:8})]):[]},{element:document.getElementById("tableau-body"),children:et(e,n.superlines,t)},{element:document.getElementById("delta-tableau"),children:[rt(e,n.deltas,t.focus,t.snapshot.frozen)]},{element:document.getElementById("equation-container"),attributes:{class:t.staleEquation?"stale":""}},{element:document.getElementById("equation"),attributes:{onclick:t=>{return e((n=t.currentTarget,e=>{e.staleEquation&&(e.staleEquation=!1,function(e,t){const n=e.nodes;let r="",i={js:{},ms:{}},s=[],o=[];n.forEach((function(t,s){if("terminal"==t.type){const r=Ie(n,s,0);if(r>s)return;const i=n[r].variable,a=t.variable;if(i==a)return;const l=it("m",i),c=it("m",a);switch(e.lines[t.lines[0]].direction){case 0:o.push(`\\delta_{${l}, ${c}}`);break;case-1:o.push(`\\delta_{${l}, -${c}}`);break;case 1:o.push(`\\delta_{-${l}, ${c}}`);break;default:throw new Error("unnormalized direction: "+direction)}}else if("w3j"==t.type){r+="\\begin{pmatrix}";let n="",o="";t.lines.forEach((function(t,r){r>0&&(n+=" & ",o+=" & ");const a=st(e,s,r,i);n+=a.j,o+=a.m})),r+=n+" \\\\",r+=o+" \\\\",r+="\\end{pmatrix}"}else r+="\\mathtt{${node.type}}_{",t.lines.forEach((function(t,n){n>0&&(r+=" ");const o=st(e,s,t,i);r+=o[0]+" "+o[1]})),r+="}"}));let a="";Object.keys(e.superlines).forEach((function(t){const n=e.superlines[t],r=it("j",t);switch(d(n.phase,4)){case 0:break;case 1:s.push("+ "+r);break;case 2:s.push("+ 2 "+r);break;case 3:s.push("- "+r)}0==n.weight||(2==n.weight?a+=` (2 ${r} + 1)`:n.weight%2==0?a+=` (2 ${r} + 1)^{${n.weight/2}}`:a+=` (2 ${r} + 1)^{${n.weight} / 2}`)})),Object.keys(e.lines).forEach((function(t){const r=e.lines[t];let i;switch(r.direction){case 0:return;case-1:const e=n[je(n,t)[1]];i="terminal"==e.type?e.variable:t;break;case 1:const r=n[je(n,t)[0]];i="terminal"==r.type?r.variable:t;break;default:throw new Error("unnormalized direction: "+direction)}const o=it("j",e.lines[t].superline),a=it("m",i);s.push(`+ ${o} ${r.direction<0?"+":"-"} ${a}`)}));let l=Object.keys(i.js).concat(Object.keys(i.ms)).join(", ");l&&(l=`\\sum_{${l}}`);let c=s.join(" ");c&&(c.startsWith("+ ")&&(c=c.substr(2)),c=`(-1)^{${c}}`);const u=o.join(" "),f=e.deltas.map(e=>{if(e.length<2)return"";const t=it("j",e[0]);return e.slice(1).map(e=>`\\delta_{${t} ${it("j",e)}}`).join(" ")}).join(" ");t.textContent=`\\[${l} ${f} ${u} ${a} ${c} ${r}\\]`,MathJax.Hub.Queue(["Typeset",MathJax.Hub])}(e.snapshot.diagram,n))}));var n}}}];var i,o,a}function dt(e,t){return ft(n=>Object.assign(e,{diagram:t(n)}))}function ft(e){return t=>{const n=e(t.snapshot.diagram,t.snapshot.frozen);if(null==n||"object"==typeof n&&null==n.diagram)return void gt(t,"not yet implemented");if("string"==typeof n)return void gt(t,n);const r=n.superficial||n.toggleFreeze||n.toggleAmbient,i=n.equivalent||r,s=n.diagram;t.snapshot.frozen&&!i||("string"!=typeof s?(t.snapshot=Object.assign({},t.snapshot,{diagram:s,frozen:Boolean(n.toggleFreeze)!=t.snapshot.frozen,showAmbient:Boolean(n.toggleAmbient)!=t.snapshot.showAmbient}),n.transient||function(e){e.savedSnapshot=e.snapshot,e.savedHash="#"+encodeURIComponent(JSON.stringify(e.snapshot)),window.location.hash=e.savedHash}(t),n.clearHover&&mt({type:null})(t),t.staleEquation=!r||t.staleEquation):gt(t,s))}}function pt(e){return e.altKey|e.ctrlKey<<1|e.shiftKey<<2}let ht=0;function gt(e,t){e.error=t,ht&&window.clearTimeout(ht),ht=window.setTimeout((function(){Et(e)(e=>e.error="")}),1e4)}function mt(e){return t=>{t.hover=e}}function yt(e){return t=>{t.focus=e}}const wt=yt({type:null});function bt(e,t){return{[xt]:"true",draggable:"true",ondragstart:function(n){n.dataTransfer.setData("text/plain",null),e(e=>{const r=t.call(this,e,n);r&&(e.drag=r)})},ondragend:function(t){e(e=>e.drag={type:null})}}}function vt(e,t,n){function r(t){e(e=>e.drop={type:null})}return{ondragenter:function(n){e(e=>{const r=t.call(this,e,n);r&&(e.drop=r)})},ondragleave:r,ondragexit:r,ondragover:function(n){e(e=>{const r=t.call(this,e,n);r&&(e.drop=r,n.preventDefault())})},ondrop:function(t){e(e=>{t.preventDefault(),n.call(this,e,t),e.drag={type:null},e.drop={type:null}})}}}function Ot(e,t){return n=>{n.trackType=t,n.trackStart.xy=[e.clientX,e.clientY],"line"==n.hover.type&&(n.trackStart.type="line",n.trackStart.lineId=n.hover.lineId)}}function jt(e,t){const n=e.lines[t];if("0"==n.superline)return!1;for(const[r,i]of Object.entries(e.lines))if(r!=t&&i.superline==n.superline)return!1;return!Z(e.deltas,n.superline)}const xt=Symbol("ENABLE_DRAG");function It(e,t,n,r){return i=>{i.dragger=r,i.draggerFlags=n,i.dragOffsetX=e-i.rawMouseX,i.dragOffsetY=t-i.rawMouseY}}function kt(e,t){if(!e instanceof Element)return;t(e);let n=e.children;for(const e of g(0,n.length))kt(n[e],t)}let St;function $t(e,t){t.snapshot;const n=e=>e(t);if(":"==St&&"3"==e.key&&(t.notice=St+e.key),null==t.focus.type){if(0==pt(e)&&"r"==e.key)return window.location.href="",void e.preventDefault();if(4==pt(e)&&"?"==e.key)return window.location.href=document.getElementById("help-link").href,void e.preventDefault();if(0==pt(e)&&"v"==e.key)return n(dt({toggleAmbient:!0},s)),void e.preventDefault();if(null!==t.mouseX){if(0==pt(e)&&"f"==e.key)return n(dt({toggleFreeze:!0},s)),void e.preventDefault();if(0==pt(e)&&"c"==e.key)return n(dt({},e=>{const n=Array.from(w(3,re(e)));return Me(e,function(e,t,n,r,i){const s=De(e,t,n,r,i);return Object.freeze(Object.assign({},s,{nodes:Object.freeze(Object.assign([],s.nodes,{3:Object.freeze(Object.assign({},s.nodes[3],{lines:Object.freeze([e,n,t])}))})),lines:Object.freeze(Object.assign({},s.lines,{[n]:Object.freeze(Object.assign({},s.lines[n],{direction:1}))})),superlines:Object.freeze(Object.assign({},s.superlines,{[t]:Object.freeze(Object.assign({},s.superlines[t],{phase:2})),[n]:Object.freeze(Object.assign({},s.superlines[n],{weight:1}))}))}))}(n[0],n[1],n[2],t.mouseX,t.mouseY))})),void e.preventDefault();if(0==pt(e)&&"w"==e.key)return n(dt({},e=>{const n=Array.from(w(3,re(e)));return Me(e,De(n[0],n[1],n[2],t.mouseX,t.mouseY))})),void e.preventDefault();if(0==pt(e)&&"a"==e.key)return n(dt({},e=>{const n=Se(e.nodes,2,t.mouseX,t.mouseY);return 2!=n.length||"terminal"!=e.nodes[n[0]].type||"terminal"!=e.nodes[n[1]].type?"no nearby terminals found":function(e,t,n){const r=(e=new Re(e)).node(t),i=e.node(n);if("terminal"!=r.type||"terminal"!=i.type)throw"cannot join non-terminals";const o=r.line(0),c=i.line(0);let u=x(e.rawDiagram);if(o.id==c.id){if(0!=o.direction)return"cannot form a directed loop";u.superlines[o.superlineId].weight+=2}else{const e=pe(o.reverse().line,c.line),t=l([o.node(1).index,o.lineIndex(1)],[c.node(1).index,c.lineIndex(1)],a)>0?ce:s;u.lines[o.id]=t(e.line),c.rawAssign(u,1,o.id),o.superlineId!=c.superlineId&&(u.superlines[o.superlineId]=ie(c.superline,o.superline,{phase:e.phase}),u.superlines[c.superlineId]=Q),u.deltas=U(u.deltas,[e.delta])}return delete u.lines[c.id],u.nodes=b(u.nodes,[r.index,i.index]),new Re(u).removeUnusedSuperlines().rawDiagram}(e,n[0],n[1])})),void e.preventDefault();if(0==pt(e)&&"m"==e.key&&"line"==t.hover.type)return n(dt({},e=>Le(e,t.hover.lineId))),void e.preventDefault();if(0==pt(e)&&"j"==e.key){if("line"==t.hover.type)return n(dt({},e=>function(e,t){return(e=new Re(e)).substitute({},{[e.line(t).superlineId]:{phase:2}}).rawDiagram}(e,t.hover.lineId))),void e.preventDefault();if("node"==t.hover.type)return n(dt({},e=>Ae(e,t.hover.nodeIndex))),void e.preventDefault()}if(0==pt(e)&&"x"==e.key)return n(dt({},e=>{const n=e.nodes,r=Se(n,1,t.mouseX,t.mouseY);return 1!=r.length||"terminal"==n[r[0]].type&&"terminal"!=n[Ie(n,r[0],0)].type?"no nearby nodes found":function(e,t){const n=(e=x(e)).nodes[t];if("terminal"==n.type){const r=Ie(e.nodes,t,0);if("terminal"!=e.nodes[r].type)throw new Error("cannot delete terminal of node");const i=e.lines[n.lines[0]].superline;delete e.lines[n.lines[0]],He(e,i)&&delete e.superlines[i],e.nodes=b(e.nodes,[t,r])}else{let r=[];n.lines.forEach((function(i,s){const o=Ie(e.nodes,t,s);if(o!=t)o<t&&(e.lines[i]=ce(e.lines[i])),r.push(be(i,i,n.x,n.y));else{const t=e.lines[i];if(!t)return;delete e.lines[i];const n=t.superline;He(e,n)&&delete e.superlines[n]}})),e.nodes.splice(t,1),e.nodes=r.concat(e.nodes)}return e}(e,r[0])})),void e.preventDefault();if(0==pt(e)&&"s"==e.key){const e=document.getElementById("diagram");let t=e.cloneNode(!0);const n=e.getBoundingClientRect();t.setAttribute("viewBox",`0 0 ${n.width} ${n.height}`),r=i.a,kt(t,e=>{let t=[];for(const n of Object.keys(r))if(e.matches(n)){const i=r[n];for(const n of Object.keys(i)){const r=n.replace(/[A-Z]/g,e=>"-"+e.toLowerCase());"transform"==r?e.setAttribute(r,i[n]):y(r)&&t.push(r+": "+i[n])}}const n=e.getAttribute("style");n&&t.push(n),t.length&&e.setAttribute("style",t.join("; "))}),kt(t,e=>{const t=e.getAttribute("href");t&&(e.removeAttribute("href"),e.setAttributeNS(Y.xlink,"href",t))});const s=URL.createObjectURL(new Blob([(new XMLSerializer).serializeToString(t)],{type:"image/svg+xml;charset=utf-8"}));let o=document.createElement("a");o.href=s,o.download="diagram.svg",document.getElementsByTagName("body")[0].appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(s)}var r;St=e.key}}}function Et(e){return(...t)=>{const n=Et(e),r=t.length;for(let n=0;n<r;++n)t[n](e);!function(e){if(K.push(e),1==K.length)for(;K.length;){K[0].forEach(e=>{const t=e.element;if(!t)throw new Error("invalid elem");e.attributes&&_(e.attributes,t),C(e.children,t)}),K.shift()}}(ut(n,e))}}function Dt(){let e={};Object.assign(e,at());Et(e)(lt)}},190:function(e,t,n){"use strict";n.r(t);var r=n(14);let i=!1;function s(e){i=i||!e,console.assert(e)}s(1==r.j([2,1,3],[2,1,3])),s(JSON.stringify(r.h([[1,2],[3,4]]))==JSON.stringify([[1,2],[3,4]])),s(JSON.stringify(r.h([[1,2],[3,4],[2,3],[5,6]]))==JSON.stringify([[1,2,3,4],[5,6]])),s(r.e([[1,2,3,4],[5,6]],[[5,6]])),s(r.e([[1,2,3,4],[5,6]],[[5,6]])),s(JSON.stringify(r.l([[1,2,3,4],[5,6]],6))==JSON.stringify([[1,2,3,4]])),s(JSON.stringify(r.k([[1,2,3,4],[5,6]],2))==JSON.stringify([2,1,3,4]));const o=r.f({nodes:[r.m("a","a",0,0),r.m("a","b",0,0)],lines:{a:r.i("a")},superlines:{a:r.c}});r.d(new r.a(o).renameLines({a:"b"}).rawDiagram,new r.a(r.f({nodes:[r.m("b","a",0,0),r.m("b","b",0,0)],lines:{b:r.i("a")},superlines:{a:r.c}})).rawDiagram),r.d((new r.a).substitute(r.b,r.b).rawDiagram,r.b),r.d(new r.a(o).substitute(r.b,r.b).rawDiagram,o),r.d(new r.a(o).substitute({nodes:[r.m("+a","x"),r.m("+a","y")],lines:{"+a":{superline:"a",direction:0}},superlines:{a:r.c}},{nodes:[r.m("a","x"),r.m("a","y")],lines:{a:{superline:"a",direction:0}},superlines:{a:r.c}}).rawDiagram,o),r.d(new r.a(o).substitute({nodes:[r.m("+a","x"),r.m("+a","y")],lines:{"+a":{superline:"a",direction:0}}},{nodes:[r.m("$1","x"),r.m("$2","y"),r.n("$4","$4","$3"),r.n("$3","$2","$1")],lines:{$4:{superline:"0",direction:1},$3:{superline:"0",direction:0},$2:{superline:"a",direction:0},$1:{superline:"a",direction:1}},superlines:{a:{weight:1}}}).rawDiagram,{nodes:[{type:"terminal",lines:["4"],variable:"a",x:0,y:0},{type:"terminal",lines:["3"],variable:"b",x:0,y:0},{type:"w3j",lines:["1","1","2"]},{type:"w3j",lines:["2","3","4"]}],superlines:{0:{phase:0,summed:!1,weight:0},a:{phase:0,summed:!1,weight:1}},lines:{1:{superline:"0",direction:0,arrowPos:.5,arcHeight:0,angle:0,textPos:.5,textOffset:0},2:{superline:"0",direction:0,arrowPos:.5,arcHeight:0,angle:0,textPos:.5,textOffset:0},3:{superline:"a",direction:0,arrowPos:.5,arcHeight:0,angle:0,textPos:.5,textOffset:0},4:{superline:"a",direction:1,arrowPos:.5,arcHeight:0,angle:0,textPos:.5,textOffset:0}},deltas:[]}),i||(document.getElementsByTagName("body")[0].style.background="black")},94:function(e,t){e.exports={"g.line *":{transition:"fill 0.3s, fill-opacity 0.3s, stroke 0.3s, stroke-opacity 0.3s"},"g.line path.bg,\ng.line path.fg,\ng.line path.hit":{fill:"none"},"g.line path.bg":{stroke:"#ffffff",strokeOpacity:"0.7",strokeWidth:"10",strokeLinecap:"round"},"g.line path.hit":{strokeOpacity:"0",strokeWidth:"25",strokeLinecap:"round"},"g.line:hover path.hit":{stroke:"#e3bd2e",strokeOpacity:"0.2"},"g.arrow:hover circle.hit":{fill:"#e3bd2e",fillOpacity:"0.2"},"g.node:hover circle.hit":{fill:"#e3bd2e",fillOpacity:"0.2"},"g.line path.fg":{strokeWidth:"2",stroke:"#051308"},"g.line path.pith":{fill:"none",stroke:"none"},"g.line.summed path.fg":{strokeWidth:"6"},"g.line.summed path.pith":{stroke:"white",strokeWidth:"2"},"g.line text.label":{fill:"#051308",alignmentBaseline:"middle",textAnchor:"middle",fontSize:"large"},"g.line.two-j text.label":{fill:"#3274b0"},"g.line.two-j path.fg":{stroke:"#3274b0"},"g.line.two-j .arrowhead":{fill:"#3274b0"},"g.line.zero path.fg":{stroke:"#a89a9f",fontWeight:"bold"},"g.line.zero text.label":{fill:"#a89a9f",fontWeight:"bold"},"g.line.zero .arrowhead":{fill:"#a89a9f",fontWeight:"bold"},"g.arrow.ambient .arrowhead":{opacity:"0.35"},"g.arrow.bad .hit":{fill:"#e74551"},"g.arrow.bad .arrowhead":{fill:"#e74551"},"g.arrow.bad.external .arrowhead":{fill:"#dcb406"},"g.arrow.bad circle.arrowhead":{opacity:".7"},"g.arrow circle.hit":{fillOpacity:"0"},"g.node *":{transition:"fill 0.3s, fill-opacity 0.3s"},"g.node circle.bg,\ng.node circle.hit":{fill:"#ffffff",fillOpacity:"0"},"g.node circle.fg":{fill:"#dddddd"},"g.node text.label":{alignmentBaseline:"middle",textAnchor:"middle",fontSize:"large"},"g.node.w3j circle.fg":{fill:"#21b0ae"},"g.node.w3j circle.fg.flipped":{fill:"#8d74c5"},"g.node.w3j use.arrow":{fill:"white"},"g.node.w3j use.arrow.flipped":{transform:"scale(-1,1)"},"g.node.terminal circle.fg":{fill:"#000000",fillOpacity:"0.3"},"g.node.terminal:hover circle.fg":{fill:"#646464",fillOpacity:"0.3"},"g.node.terminal circle.fg.frozen":{fillOpacity:"0"}}}});
//# sourceMappingURL=test.js.map